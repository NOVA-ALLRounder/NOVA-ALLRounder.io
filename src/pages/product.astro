---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import Section from '../components/ui/Section.astro';
import Container from '../components/ui/Container.astro';
import Button from '../components/ui/Button.astro';
import StepCard from '../components/ui/StepCard.astro';
import Table from '../components/ui/Table.astro';

const repo = process.env.GITHUB_REPOSITORY?.split('/')[1] ?? '';
const isUserSiteRepo = repo.endsWith('.github.io');
const basePath = process.env.GITHUB_ACTIONS === 'true'
  ? (isUserSiteRepo ? '/' : `/${repo}/`)
  : '/';
const withBase = (url: string) => {
  if (!url.startsWith('/')) return url;
  const clean = url.replace(/^\/+/, '');
  return clean ? `${basePath}${clean}` : basePath;
};
---

<BaseLayout title="Product — NOVA" description="자연어 OS 제어 에이전트. 73개+ Rust 모듈로 구성된 아키텍처, NL 자동화 파이프라인, 5계층 보안 모델을 확인하세요." lang="ko">
  <Header slot="header" lang="ko" />

  <!-- Hero -->
  <Section padding="large">
    <Container>
      <div class="text-center max-w-4xl mx-auto animate-on-scroll">
        <p class="text-caption text-[#a5b4fc] font-medium tracking-wide uppercase mb-4">Product</p>
        <h1 class="text-h1 md:text-display text-neutral-100 mb-6 text-balance">자연어 명령을 실제 OS 동작으로<br class="hidden sm:block" />변환하는 에이전트</h1>
        <p class="text-body-lg text-neutral-400 max-w-2xl mx-auto mb-10">
          NOVA는 의도 분석부터 실행, 검증, 승인까지 완전 자동화된 NL 파이프라인과 
          백그라운드에서 사용자 행동을 학습하는 Shadow Mode를 제공합니다.
          73개+ Rust 모듈로 구성된 Single Source of Truth(SSOT) 코어와 5계층 보안을 갖춘 프로덕션 레디 에이전트입니다.
        </p>
        <div class="flex flex-col sm:flex-row items-center justify-center gap-3">
          <Button variant="primary" size="lg" href={withBase('/docs/getting-started?os=macos')}>macOS에서 시작하기</Button>
          <Button variant="secondary" size="lg" href={withBase('/docs/getting-started?os=windows')}>Windows에서 시작하기</Button>
        </div>
      </div>
    </Container>
  </Section>

  <!-- NL Automation Pipeline -->
  <Section background="light">
    <Container>
      <div class="text-center mb-16 animate-on-scroll">
        <h2 class="text-h2 text-neutral-100 mb-4">NL Automation Pipeline</h2>
        <p class="text-body-lg text-neutral-400 max-w-xl mx-auto">자연어 입력 → 의도 분석 → 실행 → 검증 → 승인까지 6단계 자동 파이프라인.</p>
      </div>
      <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 animate-on-scroll">
        {[
          { step: '1', title: 'Intent', module: 'intent_router.rs', desc: '자연어 → IntentType 분류' },
          { step: '2', title: 'Slot', module: 'slot_filler.rs', desc: '필수 파라미터 추출' },
          { step: '3', title: 'Plan', module: 'plan_builder.rs', desc: '실행 단계 생성' },
          { step: '4', title: 'Execute', module: 'execution_controller.rs', desc: '단계별 자동 실행' },
          { step: '5', title: 'Verify', module: 'verification_engine.rs', desc: '결과 자동 검증' },
          { step: '6', title: 'Approve', module: 'approval_gate.rs', desc: '위험 행동 승인 게이트' },
        ].map((item) => (
          <div class="bg-[#14161b] rounded-lg border border-white/10 p-5 text-center">
            <span class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-[#a5b4fc]/10 text-[#a5b4fc] text-sm font-bold mb-3 flex-shrink-0 aspect-square">{item.step}</span>
            <h3 class="text-[0.9375rem] font-semibold text-neutral-100 mb-1">{item.title}</h3>
            <p class="text-xs text-neutral-500 font-mono mb-2 break-all overflow-hidden line-clamp-1" title={item.module}>{item.module}</p>
            <p class="text-xs text-neutral-400">{item.desc}</p>
          </div>
        ))}
      </div>
    </Container>
  </Section>

  <!-- OS Control: Visual Driver & Browser -->
  <Section>
    <Container>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center animate-on-scroll">
        <div>
          <p class="text-caption text-[#a5b4fc] font-medium tracking-wide uppercase mb-3">OS-Level Control</p>
          <h2 class="text-h2 text-neutral-100 mb-4">화면을 보고, 클릭하고, 앱을 직접 조작합니다</h2>
          <div class="space-y-6 text-body text-neutral-300">
            <div>
              <h3 class="text-h4 text-neutral-100 mb-2">Visual Driver & Rust Collector</h3>
              <p><code class="text-[#a5b4fc]">visual_driver.rs</code>와 <code class="text-[#a5b4fc]">collector_rs.rs</code>가 협업하여 화면 인식 및 데이터 수집을 수행합니다. 5분 단위 집약 및 PII 마스킹이 코어 수준에서 처리됩니다.</p>
            </div>
            <div>
              <h3 class="text-h4 text-neutral-100 mb-2">Browser Automation</h3>
              <p><code class="text-[#a5b4fc]">browser_automation.rs</code>가 웹 페이지 탐색, 폼 입력, 데이터 추출을 자동으로 수행합니다.</p>
            </div>
            <div>
              <h3 class="text-h4 text-neutral-100 mb-2">Shadow Mode</h3>
              <p><code class="text-[#a5b4fc]">analyzer.rs</code>가 백그라운드에서 수집된 이벤트를 분석하여 반복적인 루틴을 식별하고 자동화 기회를 추천합니다.</p>
            </div>
          </div>
        </div>
        <div class="bg-[#14161b] rounded-lg border border-white/10 p-6 font-mono text-sm text-neutral-400">
          <div class="flex items-center gap-2 mb-4 pb-3 border-b border-white/5">
            <span class="w-2.5 h-2.5 rounded-full bg-[#ff5f57]"></span>
            <span class="w-2.5 h-2.5 rounded-full bg-[#febc2e]"></span>
            <span class="w-2.5 h-2.5 rounded-full bg-[#28c840]"></span>
            <span class="ml-2 text-xs text-neutral-600">nova-agent</span>
          </div>
          <p class="text-neutral-500 mb-2">$ cargo run --bin local_os_agent</p>
          <p class="text-[#8fd5a6]">&gt; surf "Notes를 열어 새 메모를 만들고 Research Topic을 입력해"</p>
          <p class="text-neutral-300 mt-2">Environment Scan: Found 349 apps</p>
          <p class="text-neutral-300">Canonical: "Notes" → "Notes.app"</p>
          <p class="text-[#8fd5a6] mt-1">[OK] Notes.app 실행 (applescript.rs)</p>
          <p class="text-[#8fd5a6]">[OK] Shortcut: Cmd+N (새 메모 생성)</p>
          <p class="text-[#8fd5a6]">[OK] Type: "Research Topic" (keyboard.type)</p>
          <p class="text-neutral-300 mt-3">Verification: 메모 생성 확인 완료</p>
        </div>
      </div>
    </Container>
  </Section>

  <!-- Security Model -->
  <Section background="light">
    <Container>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center animate-on-scroll">
        <div class="order-2 lg:order-1 bg-[#14161b] rounded-lg border border-white/10 p-6 font-mono text-sm text-neutral-400">
          <div class="flex items-center gap-2 mb-4 pb-3 border-b border-white/5">
            <span class="w-2.5 h-2.5 rounded-full bg-[#ff5f57]"></span>
            <span class="w-2.5 h-2.5 rounded-full bg-[#febc2e]"></span>
            <span class="w-2.5 h-2.5 rounded-full bg-[#28c840]"></span>
            <span class="ml-2 text-xs text-neutral-600">security-model</span>
          </div>
          <p class="text-neutral-300 mb-3">Action Classification:</p>
          <p class="text-[#8fd5a6] ml-4">Safe: ui.find, screen.capture, app.list</p>
          <p class="text-[#febc2e] ml-4">Caution: ui.click, keyboard.type</p>
          <p class="text-red-400 ml-4">Critical: file.delete, cmd.exec, submit.payment</p>
          <p class="text-neutral-500 mt-4">Write Lock: LOCKED (default)</p>
          <p class="text-neutral-500">Tool Policy: TOOL_ALLOWLIST / TOOL_DENYLIST</p>
          <p class="text-neutral-500">PII Guard: [EMAIL], [CARD], [SSN] → masked</p>
          <p class="text-neutral-500">Kill Switch: Esc 연타 → 즉시 종료</p>
        </div>
        <div class="order-1 lg:order-2">
          <p class="text-caption text-[#a5b4fc] font-medium tracking-wide uppercase mb-3">Zero Trust Security</p>
          <h2 class="text-h2 text-neutral-100 mb-4">5계층 보안으로 모든 실행을 통제합니다</h2>
          <div class="space-y-4 text-body text-neutral-300">
            <div>
              <h3 class="text-h4 text-neutral-100 mb-1">1. PolicyEngine (policy.rs)</h3>
              <p class="text-sm">Safe / Caution / Critical 3단계로 행동을 분류합니다.</p>
            </div>
            <div>
              <h3 class="text-h4 text-neutral-100 mb-1">2. CommandClassifier (security.rs)</h3>
              <p class="text-sm">셸 명령의 위험도를 자동 분석하여 차단합니다.</p>
            </div>
            <div>
              <h3 class="text-h4 text-neutral-100 mb-1">3. ToolPolicy (tool_policy.rs)</h3>
              <p class="text-sm">환경변수 기반 도구별 Allow/Denylist를 관리합니다.</p>
            </div>
            <div>
              <h3 class="text-h4 text-neutral-100 mb-1">4. PrivacyGuard (privacy.rs)</h3>
              <p class="text-sm">이메일, 카드번호 등 PII를 DB 저장 전 자동 마스킹합니다.</p>
            </div>
            <div>
              <h3 class="text-h4 text-neutral-100 mb-1">5. API Auth (api_server.rs)</h3>
              <p class="text-sm">STEER_API_KEY 기반 미들웨어 인증을 적용합니다.</p>
            </div>
          </div>
        </div>
      </div>
    </Container>
  </Section>

  <!-- Integrations -->
  <Section>
    <Container>
      <div class="text-center mb-16 animate-on-scroll">
        <h2 class="text-h2 text-neutral-100 mb-4">External Integrations</h2>
        <p class="text-body-lg text-neutral-400 max-w-xl mx-auto">네이티브 연동으로 일상 서비스를 자동화합니다.</p>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 animate-on-scroll">
        {[
          { title: 'Gmail', module: 'gmail.rs (5KB)', features: ['이메일 조회/발송', '분류 자동화', 'Gmail API 연동'] },
          { title: 'Google Calendar', module: 'calendar.rs (5KB)', features: ['일정 조회/생성', '리마인더 관리', 'Google OAuth 연동'] },
          { title: 'Notion', module: 'notion.rs (6KB)', features: ['페이지 읽기/쓰기', '데이터베이스 조회', 'Notion API 연동'] },
          { title: 'Telegram', module: 'telegram.rs (12KB)', features: ['원격 명령 실행', '결과 리포트 전송', '외출 중 PC 제어'] },
        ].map((item) => (
          <div class="bg-[#14161b] rounded-lg border border-white/10 p-6">
            <h3 class="text-h4 text-neutral-100 mb-2">{item.title}</h3>
            <p class="text-xs text-neutral-600 font-mono mb-4">{item.module}</p>
            <ul class="space-y-2">
              {item.features.map((f) => (
                <li class="flex items-center gap-2 text-sm text-neutral-400">
                  <svg class="w-4 h-4 text-[#a5b4fc] flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                  {f}
                </li>
              ))}
            </ul>
          </div>
        ))}
      </div>
    </Container>
  </Section>

  <!-- Technical Spec -->
  <Section background="light">
    <Container>
      <div class="animate-on-scroll">
        <div class="text-center mb-12">
          <h2 class="text-h2 text-neutral-100 mb-4">Technical Specification</h2>
          <p class="text-body-lg text-neutral-400">NOVA 에이전트의 전체 아키텍처와 기술 스택.</p>
        </div>
        <Table>
          <thead>
            <tr>
              <th>구성 요소</th>
              <th>기술 스택</th>
              <th>상세</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>Core Engine</td><td>Rust (73+ 모듈)</td><td>main.rs, core::lib.rs (Single Source of Truth), api_server.rs (Axum)</td></tr>
            <tr><td>NL Pipeline</td><td>6-stage Automation</td><td>intent_router → slot_filler → plan_builder → execution → verification → approval</td></tr>
            <tr><td>Shadow Mode</td><td>Batch Pipeline</td><td>collector_rs → build_sessions → build_routines → build_handoff (Rust native)</td></tr>
            <tr><td>OS Control</td><td>AppleScript + Visual Driver</td><td>visual_driver.rs (39KB), browser_automation.rs, screen_recorder.rs</td></tr>
            <tr><td>Storage</td><td>SQLite (steer.db)</td><td>이벤트 로그(v2), 5분 집약, 일일 요약, 세션/루틴/핸드오프 데이터</td></tr>
            <tr><td>Orchestration</td><td>n8n (Docker / NPX)</td><td>n8n_api.rs, STEER_N8N_RUNTIME 지원 (Docker/NPX/Manual)</td></tr>
            <tr><td>Web UI</td><td>React/Vite + Tailwind</td><td>Dashboard, Chat, Launcher, Routines, Workflows, Settings</td></tr>
            <tr><td>Desktop</td><td>Tauri</td><td>macOS .app / Windows .exe 네이티브 앱 생성</td></tr>
            <tr><td>Integrations</td><td>Gmail, Calendar, Notion, Telegram</td><td>Google OAuth, Notion API, Telegram Bot API 연동</td></tr>
            <tr><td>Security</td><td>5-layer Zero Trust</td><td>policy.rs, security.rs, tool_policy.rs, privacy.rs, api_server auth</td></tr>
            <tr><td>Data Pipeline</td><td>Rust Collector + Sensors</td><td>build_sessions_rs, build_routines_rs, build_handoff_rs</td></tr>
            <tr><td>Reliability</td><td>Self-Healing Guardian</td><td>프로세스 자동 재시작, retry_logic.rs, singleton_lock.rs</td></tr>
          </tbody>
        </Table>
      </div>
    </Container>
  </Section>

  <!-- CTA -->
  <Section background="dark">
    <Container>
      <div class="text-center animate-on-scroll">
        <h2 class="text-h2 text-white mb-4">직접 확인해 보세요</h2>
        <p class="text-body-lg text-neutral-400 max-w-xl mx-auto mb-10">
          Getting Started 가이드에 따라 5분 이내에 첫 번째 자동화를 실행할 수 있습니다.
        </p>
        <div class="flex flex-col sm:flex-row items-center justify-center gap-4">
          <Button variant="primary" size="lg" href={withBase('/docs/getting-started')}>시작하기</Button>
          <Button variant="ghost" size="lg" href={withBase('/contact')}>기술팀 문의</Button>
        </div>
      </div>
    </Container>
  </Section>

  <Footer slot="footer" />
</BaseLayout>

<style>
  .product-segment-card {
    background: var(--site-bg-soft);
    border: 1px solid var(--site-border);
    border-radius: 0.875rem;
    padding: 2rem;
  }
  @media (min-width: 768px) {
    .product-segment-card {
      padding: 2.5rem;
    }
  }
</style>
