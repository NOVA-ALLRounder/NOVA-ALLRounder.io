---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import Section from '../../components/ui/Section.astro';
import Container from '../../components/ui/Container.astro';
import Button from '../../components/ui/Button.astro';
import Table from '../../components/ui/Table.astro';

const repo = process.env.GITHUB_REPOSITORY?.split('/')[1] ?? '';
const isUserSiteRepo = repo.endsWith('.github.io');
const basePath = process.env.GITHUB_ACTIONS === 'true'
  ? (isUserSiteRepo ? '/' : `/${repo}/`)
  : '/';
const withBase = (url: string) => {
  if (!url.startsWith('/')) return url;
  const clean = url.replace(/^\/+/, '');
  return clean ? `${basePath}${clean}` : basePath;
};
---

<BaseLayout title="Product — NOVA" description="Natural language OS control agent. Explore the architecture of 73+ Rust modules, NL automation pipeline, and 5-layer security model." lang="en">
  <Header slot="header" lang="en" />

  <!-- Hero -->
  <Section padding="large">
    <Container>
      <div class="text-center max-w-4xl mx-auto animate-on-scroll">
        <p class="text-caption text-accent-300 font-medium tracking-wide uppercase mb-4">Product</p>
        <h1 class="text-h1 md:text-display text-neutral-100 mb-6 text-balance">Transforming natural language commands<br class="hidden sm:block" />into actual OS actions</h1>
        <p class="text-body-lg text-neutral-400 max-w-2xl mx-auto mb-10">
          An agent that provides a fully automated NL pipeline from intent analysis to execution, verification, and approval.
          A production-ready agent consisting of 73+ Rust modules, 5-layer security, and 4 external service integrations.
        </p>
        <div class="flex flex-col sm:flex-row items-center justify-center gap-3">
          <Button variant="primary" size="lg" href={withBase('/en/docs/getting-started?os=macos')}>Start for macOS</Button>
          <Button variant="secondary" size="lg" href={withBase('/en/docs/getting-started?os=windows')}>Start for Windows</Button>
        </div>
      </div>
    </Container>
  </Section>

  <!-- NL Automation Pipeline -->
  <Section background="light">
    <Container>
      <div class="text-center mb-16 animate-on-scroll">
        <h2 class="text-h2 text-neutral-100 mb-4">NL Automation Pipeline</h2>
        <p class="text-body-lg text-neutral-400 max-w-xl mx-auto">A 6-stage automated pipeline from natural language input to intention analysis, execution, verification, and approval.</p>
      </div>
      <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 animate-on-scroll">
        {[
          { step: '1', title: 'Intent', module: 'intent_router.rs', desc: 'Classify NL → IntentType' },
          { step: '2', title: 'Slot', module: 'slot_filler.rs', desc: 'Extract required parameters' },
          { step: '3', title: 'Plan', module: 'plan_builder.rs', desc: 'Generate execution steps' },
          { step: '4', title: 'Execute', module: 'execution_controller.rs', desc: 'Automated step-by-step execution' },
          { step: '5', title: 'Verify', module: 'verification_engine.rs', desc: 'Automated result verification' },
          { step: '6', title: 'Approve', module: 'approval_gate.rs', desc: 'Security gate for dangerous actions' },
        ].map((item) => (
          <div class="bg-[#14161b] rounded-lg border border-white/10 p-5 text-center">
            <span class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-accent-300/10 text-accent-300 text-sm font-bold mb-3">{item.step}</span>
            <h3 class="text-[0.9375rem] font-semibold text-neutral-100 mb-1">{item.title}</h3>
            <p class="text-xs text-neutral-500 font-mono mb-2">{item.module}</p>
            <p class="text-xs text-neutral-400">{item.desc}</p>
          </div>
        ))}
      </div>
    </Container>
  </Section>

  <!-- OS Control: Visual Driver & Browser -->
  <Section>
    <Container>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center animate-on-scroll">
        <div>
          <p class="text-caption text-accent-300 font-medium tracking-wide uppercase mb-3">OS-Level Control</p>
          <h2 class="text-h2 text-neutral-100 mb-4">Watch the screen, click, and manipulate apps directly</h2>
          <div class="space-y-6 text-body text-neutral-300">
            <div>
              <h3 class="text-h4 text-neutral-100 mb-2">Visual Driver</h3>
              <p><code class="text-accent-300">visual_driver.rs</code> (39KB) recognizes screen elements and automatically controls mouse/keyboard. Integrates AppleScript, browser automation, and UI navigation.</p>
            </div>
            <div>
              <h3 class="text-h4 text-neutral-100 mb-2">Browser Automation</h3>
              <p><code class="text-accent-300">browser_automation.rs</code> automatically performs web page navigation, form input, and data extraction.</p>
            </div>
            <div>
              <h3 class="text-h4 text-neutral-100 mb-2">Reality Check</h3>
              <p><code class="text-accent-300">reality_check.rs</code> scans installed apps before execution and automatically corrects similar names to prevent hallucinations.</p>
            </div>
          </div>
        </div>
        <div class="bg-[#14161b] rounded-lg border border-white/10 p-6 font-mono text-sm text-neutral-400">
          <div class="flex items-center gap-2 mb-4 pb-3 border-b border-white/5">
            <span class="w-2.5 h-2.5 rounded-full bg-[#ff5f57]"></span>
            <span class="w-2.5 h-2.5 rounded-full bg-[#febc2e]"></span>
            <span class="w-2.5 h-2.5 rounded-full bg-[#28c840]"></span>
            <span class="ml-2 text-xs text-neutral-600">nova-agent</span>
          </div>
          <p class="text-neutral-500 mb-2">$ cargo run --bin local_os_agent</p>
          <p class="text-[#8fd5a6]">&gt; surf "Open Notes, create a new note, and type Research Topic"</p>
          <p class="text-neutral-300 mt-2">Environment Scan: Found 349 apps</p>
          <p class="text-neutral-300">Canonical: "Notes" → "Notes.app"</p>
          <p class="text-[#8fd5a6] mt-1">[OK] Notes.app execution (applescript.rs)</p>
          <p class="text-[#8fd5a6]">[OK] Shortcut: Cmd+N (Create new note)</p>
          <p class="text-[#8fd5a6]">[OK] Type: "Research Topic" (keyboard.type)</p>
          <p class="text-neutral-300 mt-3">Verification: Note creation confirmed</p>
        </div>
      </div>
    </Container>
  </Section>

  <!-- Security Model -->
  <Section background="light">
    <Container>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center animate-on-scroll">
        <div class="order-2 lg:order-1 bg-[#14161b] rounded-lg border border-white/10 p-6 font-mono text-sm text-neutral-400">
          <div class="flex items-center gap-2 mb-4 pb-3 border-b border-white/5">
            <span class="w-2.5 h-2.5 rounded-full bg-[#ff5f57]"></span>
            <span class="w-2.5 h-2.5 rounded-full bg-[#febc2e]"></span>
            <span class="w-2.5 h-2.5 rounded-full bg-[#28c840]"></span>
            <span class="ml-2 text-xs text-neutral-600">security-model</span>
          </div>
          <p class="text-neutral-300 mb-3">Action Classification:</p>
          <p class="text-[#8fd5a6] ml-4">Safe: ui.find, screen.capture, app.list</p>
          <p class="text-[#febc2e] ml-4">Caution: ui.click, keyboard.type</p>
          <p class="text-red-400 ml-4">Critical: file.delete, cmd.exec, submit.payment</p>
          <p class="text-neutral-500 mt-4">Write Lock: LOCKED (default)</p>
          <p class="text-neutral-500">Tool Policy: TOOL_ALLOWLIST / TOOL_DENYLIST</p>
          <p class="text-neutral-500">PII Guard: [EMAIL], [CARD], [SSN] → masked</p>
          <p class="text-neutral-500">Kill Switch: Multi-press Esc → Instant Exit</p>
        </div>
        <div class="order-1 lg:order-2">
          <p class="text-caption text-accent-300 font-medium tracking-wide uppercase mb-3">Zero Trust Security</p>
          <h2 class="text-h2 text-neutral-100 mb-4">Control all executions with 5-layer security</h2>
          <div class="space-y-4 text-body text-neutral-300">
            <div>
              <h3 class="text-h4 text-neutral-100 mb-1">1. PolicyEngine (policy.rs)</h3>
              <p class="text-sm">Classifies actions into 3 levels: Safe / Caution / Critical.</p>
            </div>
            <div>
              <h3 class="text-h4 text-neutral-100 mb-1">2. CommandClassifier (security.rs)</h3>
              <p class="text-sm">Automatically analyzes the risk of shell commands and blocks them.</p>
            </div>
            <div>
              <h3 class="text-h4 text-neutral-100 mb-1">3. ToolPolicy (tool_policy.rs)</h3>
              <p class="text-sm">Manages per-tool Allow/Denylists based on environment variables.</p>
            </div>
            <div>
              <h3 class="text-h4 text-neutral-100 mb-1">4. PrivacyGuard (privacy.rs)</h3>
              <p class="text-sm">Automatically masks PII such as emails and card numbers before saving to the DB.</p>
            </div>
            <div>
              <h3 class="text-h4 text-neutral-100 mb-1">5. API Auth (api_server.rs)</h3>
              <p class="text-sm">Applies middleware authentication based on STEER_API_KEY.</p>
            </div>
          </div>
        </div>
      </div>
    </Container>
  </Section>

  <!-- Integrations -->
  <Section>
    <Container>
      <div class="text-center mb-16 animate-on-scroll">
        <h2 class="text-h2 text-neutral-100 mb-4">External Integrations</h2>
        <p class="text-body-lg text-neutral-400 max-w-xl mx-auto">Automate everyday services with native integrations.</p>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 animate-on-scroll">
        {[
          { title: 'Gmail', module: 'gmail.rs (5KB)', features: ['Email lookup/send', 'Classification automation', 'Gmail API integration'] },
          { title: 'Google Calendar', module: 'calendar.rs (5KB)', features: ['Schedule lookup/create', 'Reminder management', 'Google OAuth integration'] },
          { title: 'Notion', module: 'notion.rs (6KB)', features: ['Read/write pages', 'Database query', 'Notion API integration'] },
          { title: 'Telegram', module: 'telegram.rs (12KB)', features: ['Remote command execution', 'Result report transmission', 'PC control while away'] },
        ].map((item) => (
          <div class="bg-[#14161b] rounded-lg border border-white/10 p-6">
            <h3 class="text-h4 text-neutral-100 mb-2">{item.title}</h3>
            <p class="text-xs text-neutral-600 font-mono mb-4">{item.module}</p>
            <ul class="space-y-2">
              {item.features.map((f) => (
                <li class="flex items-center gap-2 text-sm text-neutral-400">
                  <svg class="w-4 h-4 text-accent-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                  {f}
                </li>
              ))}
            </ul>
          </div>
        ))}
      </div>
    </Container>
  </Section>

  <!-- Technical Spec -->
  <Section background="light">
    <Container>
      <div class="animate-on-scroll">
        <div class="text-center mb-12">
          <h2 class="text-h2 text-neutral-100 mb-4">Technical Specification</h2>
          <p class="text-body-lg text-neutral-400">Full architecture and technology stack of the NOVA agent.</p>
        </div>
        <Table>
          <thead>
            <tr>
              <th>Component</th>
              <th>Tech Stack</th>
              <th>Detail</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>Core Engine</td><td>Rust (73+ modules)</td><td>main.rs (1,112 lines), api_server.rs (90KB), llm_gateway.rs (72KB)</td></tr>
            <tr><td>NL Pipeline</td><td>6-stage Automation</td><td>intent_router → slot_filler → plan_builder → execution → verification → approval</td></tr>
            <tr><td>LLM Engine</td><td>OpenAI API</td><td>GPT-4 / GPT-3.5-based intent analysis, pattern recognition, workflow generation</td></tr>
            <tr><td>OS Control</td><td>AppleScript + Visual Driver</td><td>visual_driver.rs (39KB), browser_automation.rs, screen_recorder.rs</td></tr>
            <tr><td>Storage</td><td>SQLite (steer.db)</td><td>Event logs, 5-min aggregation, daily summary, session/routine/handoff</td></tr>
            <tr><td>Orchestration</td><td>n8n (Docker / NPX)</td><td>n8n_api.rs (36KB), REST API integration, automated workflow generation</td></tr>
            <tr><td>Web UI</td><td>React/Vite + Tailwind</td><td>Dashboard, Chat, Launcher, Routines, Workflows, Settings</td></tr>
            <tr><td>Desktop</td><td>Tauri</td><td>Native apps for macOS (.app) / Windows (.exe)</td></tr>
            <tr><td>Integrations</td><td>Gmail, Calendar, Notion, Telegram</td><td>Google OAuth, Notion API, Telegram Bot API integration</td></tr>
            <tr><td>Security</td><td>5-layer Zero Trust</td><td>policy.rs, security.rs, tool_policy.rs, privacy.rs, api_server auth</td></tr>
            <tr><td>Data Pipeline</td><td>Rust Collector + Sensors</td><td>build_sessions_rs, build_routines_rs, build_handoff_rs</td></tr>
            <tr><td>Reliability</td><td>Self-Healing Guardian</td><td>Automatic process restarts, retry_logic.rs, singleton_lock.rs</td></tr>
          </tbody>
        </Table>
      </div>
    </Container>
  </Section>

  <!-- CTA -->
  <Section background="dark">
    <Container>
      <div class="text-center animate-on-scroll">
        <h2 class="text-h2 text-white mb-4">Check it out for yourself</h2>
        <p class="text-body-lg text-neutral-400 max-w-xl mx-auto mb-10">
          Following the Getting Started guide, you can run your first automation in less than 5 minutes.
        </p>
        <div class="flex flex-col sm:flex-row items-center justify-center gap-4">
          <Button variant="primary" size="lg" href={withBase('/en/docs/getting-started')}>Get Started</Button>
          <Button variant="ghost" size="lg" href={withBase('/en/contact')}>Contact Technical Team</Button>
        </div>
      </div>
    </Container>
  </Section>

  <Footer slot="footer" lang="en" />
</BaseLayout>
