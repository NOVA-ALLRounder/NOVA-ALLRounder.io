---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import Header from '../../../components/Header.astro';
import Footer from '../../../components/Footer.astro';
import Section from '../../../components/ui/Section.astro';
import Container from '../../../components/ui/Container.astro';
import Button from '../../../components/ui/Button.astro';

const repo = process.env.GITHUB_REPOSITORY?.split('/')[1] ?? '';
const isUserSiteRepo = repo.endsWith('.github.io');
const basePath = process.env.GITHUB_ACTIONS === 'true'
  ? (isUserSiteRepo ? '/' : `/${repo}/`)
  : '/';
const withBase = (url: string) => {
  if (!url.startsWith('/')) return url;
  const clean = url.replace(/^\/+/, '');
  return clean ? `${basePath}${clean}` : basePath;
};

const categories = [
  {
    title: 'Getting Started',
    desc: 'Provides a complete guide from installation and environment configuration to running your first automation.',
    href: '/docs/getting-started',
    tag: 'Start Here',
  },
  {
    title: 'Tutorials',
    desc: 'Step-by-step guides based on real-world scenarios like email classification and report automation.',
    href: '/docs/tutorials',
    tag: null,
  },
  {
    title: 'API Reference',
    desc: 'Detailed documentation on authentication, endpoints, request/response formats, and rate limit policies.',
    href: '/docs/api',
    tag: null,
  },
  {
    title: 'FAQ',
    desc: 'Frequently asked questions and troubleshooting regarding installation, security, data management, and performance.',
    href: '/docs/faq',
    tag: null,
  },
  {
    title: 'Changelog',
    desc: 'Track new features, improvements, and bug fixes for each version.',
    href: '/docs/changelog',
    tag: 'Latest',
  },
];

const popularDocs = [
  { title: 'Run your first automation in 5 minutes', href: '/docs/getting-started', category: 'Getting Started' },
  { title: 'Set up an automated email classification workflow', href: '/docs/tutorials', category: 'Tutorial' },
  { title: 'POST /automations — Create Automation', href: '/docs/api', category: 'API' },
  { title: 'Webhook retry policy and error handling', href: '/docs/faq', category: 'FAQ' },
];
---

<BaseLayout title="Documentation — NOVA" description="Official technical documentation for installing, operating, and integrating NOVA." lang="en">
  <Header slot="header" lang="en" />

  <!-- Hero -->
  <Section padding="large">
    <Container>
      <div class="text-center max-w-3xl mx-auto mb-16 animate-on-scroll">
        <p class="accent-pill mb-5">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:inline-block;vertical-align:-2px;margin-right:4px;"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
          Documentation
        </p>
        <h1 class="text-h1 md:text-display text-neutral-100 mb-6 text-balance">NOVA Technical Documentation</h1>
        <p class="text-body-lg text-neutral-400 max-w-2xl mx-auto">
          From installation to API integration and workflow operation — find all the information you need to fully leverage our services.
        </p>
      </div>

      <!-- Search -->
      <div class="max-w-xl mx-auto mb-16 animate-on-scroll">
        <div class="relative">
          <svg class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
          <input
            type="search"
            placeholder="Search documentation..."
            disabled
            class="w-full pl-12 pr-4 py-3.5 bg-[#14161b] rounded-lg border border-white/10 text-body text-neutral-500 cursor-not-allowed focus:border-[var(--site-accent)]/40 transition-colors"
            aria-label="Search documentation"
          />
          <span class="absolute right-4 top-1/2 -translate-y-1/2 text-xs text-neutral-600 border border-white/10 rounded px-1.5 py-0.5 font-mono">Ctrl K</span>
        </div>
      </div>

      <!-- Category Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5 animate-on-scroll">
        {categories.map((cat) => (
          <a href={withBase('/en' + cat.href)} class="docs-category-card group">
            <div class="flex items-start justify-between mb-3">
              <h2 class="text-[1.0625rem] font-semibold text-neutral-100 group-hover:text-white transition-colors">{cat.title}</h2>
              {cat.tag && <span class="docs-category-tag">{cat.tag}</span>}
            </div>
            <p class="text-[0.8125rem] text-neutral-400 leading-relaxed">{cat.desc}</p>
            <span class="docs-category-arrow">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
            </span>
          </a>
        ))}
      </div>
    </Container>
  </Section>

  <!-- Quick Start Preview -->
  <Section background="light">
    <Container>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center animate-on-scroll">
        <div>
          <p class="text-caption text-[#a5b4fc] font-medium tracking-wide uppercase mb-3">Quick Start</p>
          <h2 class="text-h2 text-neutral-100 mb-4">Get started in 3 steps</h2>
          <p class="text-body-lg text-neutral-400 mb-6">
            Clone the repository, set environment variables, and build — you can run the NOVA agent in just three steps. 5 minutes is all it takes to run your first automation.
          </p>
          <div class="flex flex-col sm:flex-row gap-3">
            <Button variant="primary" href={withBase('/en/docs/getting-started?os=macos')}>Start on macOS</Button>
            <Button variant="secondary" href={withBase('/en/docs/getting-started?os=windows')}>Start on Windows</Button>
          </div>
        </div>
        <div class="bg-[#0a0b0e] rounded-lg border border-white/10 p-5 font-mono text-sm">
          <div class="flex items-center gap-2 mb-4 pb-3 border-b border-white/5">
            <span class="w-3 h-3 rounded-full bg-[#ff5f57]"></span>
            <span class="w-3 h-3 rounded-full bg-[#febc2e]"></span>
            <span class="w-3 h-3 rounded-full bg-[#28c840]"></span>
            <span class="ml-2 text-xs text-neutral-600">Terminal</span>
          </div>
          <p class="text-neutral-500">
            <span class="text-neutral-400">$</span> git clone https://github.com/NOVA-ALLRounder/main.git
          </p>
          <p class="text-neutral-500 mt-1">
            <span class="text-neutral-400">$</span> cd main/core && cp .env.example .env
          </p>
          <p class="text-neutral-500 mt-1">
            <span class="text-neutral-400">$</span> cargo build --release
          </p>
          <p class="text-[#8fd5a6] mt-3">Build complete — ./target/release/local_os_agent</p>
          <p class="text-neutral-500 mt-3">
            <span class="text-neutral-400">$</span> ./target/release/local_os_agent
          </p>
          <p class="text-[#8fd5a6] mt-1">NOVA Agent ready. Type 'help' for available commands.</p>
        </div>
      </div>
    </Container>
  </Section>

  <!-- Popular Docs -->
  <Section>
    <Container>
      <div class="animate-on-scroll">
        <div class="text-center mb-10">
          <h2 class="text-h2 text-neutral-100 mb-3">Popular Docuementation</h2>
          <p class="text-body text-neutral-400">Quickly find our most frequently referenced items.</p>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-3xl mx-auto">
          {popularDocs.map((doc) => (
            <a href={withBase('/en' + doc.href)} class="docs-popular-item group">
              <div>
                <span class="text-[0.6875rem] font-semibold uppercase tracking-wider text-[#a5b4fc]">{doc.category}</span>
                <p class="text-[0.9375rem] text-neutral-200 font-medium mt-1 group-hover:text-white transition-colors">{doc.title}</p>
              </div>
              <svg class="w-4 h-4 text-neutral-500 group-hover:text-neutral-300 transition-colors flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
            </a>
          ))}
        </div>
      </div>
    </Container>
  </Section>

  <!-- CTA -->
  <Section background="dark">
    <Container narrow>
      <div class="text-center animate-on-scroll">
        <h2 class="text-h2 text-white mb-4">Need more help?</h2>
        <p class="text-body-lg text-neutral-400 mb-8">
          You can open an issue on GitHub or contact our technical team directly.
        </p>
        <div class="flex flex-col sm:flex-row items-center justify-center gap-3">
          <Button variant="primary" href="https://github.com/NOVA-ALLRounder/main/issues" external>GitHub Issues</Button>
          <Button variant="ghost" href={withBase('/en/contact')}>Contact</Button>
        </div>
      </div>
    </Container>
  </Section>

  <Footer slot="footer" lang="en" />
</BaseLayout>

<style>
  .docs-category-card {
    position: relative;
    display: block;
    padding: 1.5rem;
    background: var(--site-bg-soft);
    border: 1px solid var(--site-border);
    border-radius: 0.75rem;
    text-decoration: none;
    transition: all 0.2s;
    overflow: hidden;
  }
  .docs-category-card:hover {
    border-color: rgba(245, 238, 155, 0.2);
    background: var(--site-bg-raised);
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
  }
  .docs-category-tag {
    font-size: 0.625rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    padding: 0.1875rem 0.5rem;
    border-radius: 999px;
    background: rgba(245, 238, 155, 0.1);
    color: var(--site-accent-strong);
    border: 1px solid rgba(245, 238, 155, 0.2);
  }
  .docs-category-arrow {
    position: absolute;
    bottom: 1.25rem;
    right: 1.25rem;
    color: var(--site-text-muted);
    opacity: 0;
    transform: translateX(-4px);
    transition: all 0.2s;
  }
  .docs-category-card:hover .docs-category-arrow {
    opacity: 1;
    transform: translateX(0);
  }

  .docs-popular-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    padding: 1rem 1.25rem;
    background: var(--site-bg-soft);
    border: 1px solid var(--site-border);
    border-radius: 0.625rem;
    text-decoration: none;
    transition: all 0.2s;
  }
  .docs-popular-item:hover {
    border-color: rgba(255, 255, 255, 0.1);
    background: var(--site-bg-raised);
  }
</style>
